<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>í˜„ì¬ ìœ„ì¹˜ ë° ë‚ ì”¨ ì •ë³´</title>
<style>        
    body { text-align: center; background-color: white; }
    h3{padding:10px; font-size: larger;}
    body {font-size: large;}
</style>
</head>

<body>
<h3>í˜„ì¬ ìœ„ì¹˜ ë° ë‚ ì”¨ ì¶œë ¥</h3>
<hr>
<div id="msg">ì´ê³³ì— ìœ„ì¹˜ ì •ë³´ ì¶œë ¥</div>
<div id="weather">ë‚ ì”¨ ì •ë³´ ë¡œë”© ì¤‘...</div>
<script>
const apiKey = '77394a2e8a441f7bbc2756f3b7fe6395';

if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(success, error);
} else {
    alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
}

function success(position) {
    const lat = position.coords.latitude.toPrecision(6);
    const lon = position.coords.longitude.toPrecision(6);
    const acc = position.coords.accuracy;

    fetchWeather(lat, lon);
    updateTime(lat, lon, acc);
    setInterval(() => updateTime(lat, lon, acc), 1000);
}

function error(err) {
    console.error(`ERROR(${err.code}): ${err.message}`);
    document.getElementById("msg").innerHTML = `ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${err.message}`;
}

function updateTime(lat, lon, acc) {
    const now = new Date().toLocaleString("ko-KR", {timeZone: "Asia/Seoul"});
    const text = `<br>í˜„ì¬ ì‹œê°„: ${now}<br>í˜„ì¬ ìœ„ì¹˜: ìœ„ë„ ${lat}Â°, ê²½ë„ ${lon}Â°<br>ì •í™•ë„: ${acc}m`;
    document.getElementById("msg").innerHTML = text;
}

function fetchWeather(lat, lon) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=kr`;
    fetch(url)
    .then(response => {
        if (!response.ok) {
            throw new Error(`ì‘ë‹µ ì˜¤ë¥˜: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        const weather = data.weather[0].description;
        const temp = data.main.temp;
        let emoji = ""; // ì´ëª¨í‹°ì½˜ì„ ì €ì¥í•  ë³€ìˆ˜ ì´ˆê¸°í™”
        if (temp < 0) {
            emoji = "ì¶”ì›Œìš”ğŸ¥¶ <br> ë”°ëœ»í•˜ê²Œ ì…ê³  ë‚˜ê°€ì„¸ìš”!";
        } else if (temp < 10) {
            emoji = "ì¡°ê¸ˆ ì¶”ì›Œìš”ğŸ˜¬ <br> ê²‰ì˜·ì„ ì±™ê¸°ëŠ”ê²Œ ì¢‹ì„ê±°ê°™ì•„ìš”!";
        } else if (temp < 20) {
            emoji = " ì ë‹¹í•´ìš”ğŸ˜„ <br> ì‚°ì±…ê°€ê¸° ì¢‹ì€ë‚ ì´ê² ë„¤ìš”!";
        } else if (temp < 30) {
            emoji = "ì¡°ê¸ˆ ë”ì›Œìš”ğŸ˜¥ <br> ë°–ì—ì„œ ë‹¤ë‹ˆê¸°ì—ëŠ” í˜ë“¤ê±°ê°™ì•„ìš”";
        } else if (temp >= 35) {
            emoji = "ë”ì›Œìš”ğŸ¥µ <br> ì§‘ì—ì„œ ìˆëŠ”ê²Œ ì¢‹ì„ê±°ê°™ë„¤ìš”";
        }
        document.getElementById('weather').innerHTML = `ë‚ ì”¨: ${weather} ,ì˜¨ë„: ${temp}Â°C <br><br><hr><br> ì˜¤ëŠ˜ ê¸°ì˜¨ì€ "${temp}Â°C, ${emoji}"`;
    })
    .catch(error => {
        console.error('ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', error);
        document.getElementById('weather').innerHTML = `ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`;
    });
}


</script>
</body>
</html>
